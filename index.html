<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moon Exploration</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
</head>
<body>
    <div class="navbar">
        <a href="#home">Home</a>
        <a href="#about">About</a>
        <a href="#landings">Recent Landings</a>
        <a href="#moonquakes">Moonquakes</a>
    </div>

    <header id="home">
        <h1>Moon Exploration</h1>
    </header>


    <div class="toggle-container">
        <p>Landing Site</p>
        <label class="switch">
          <input id="toggle_landingSites" type="checkbox">
          <span class="slider"></span>
        </label>
    </div>

    <div class="toggle-container">
        <p>Moonquakes</p>
        <label class="switch">
          <input id="toggle_moonquakes" type="checkbox">
          <span class="slider"></span>
        </label>
    </div>

    <div class="toggle-container">
        <p>Topographic view</p>
        <label class="switch">
          <input id="toggle_topographic" type="checkbox">
          <span class="slider"></span>
        </label>
    </div>
    
    <div id="moonContainer">
    </div>
    <main>
        <section id="about">
            <h2>About Moon Exploration</h2>
            <p>Learn about historic moon landings and moonquakes on this interactive globe.</p>
        </section>

        <section id="landings">
            <h2>Recent Moon Landings</h2>
            <ul id="landingsList">
                <!-- Landings data will be inserted here -->
            </ul>
        </section>

        <section id="moonquakes">
            <h2>Moonquake Data</h2>
            <ul id="moonquakeList">
                <!-- Moonquake data will be inserted here -->
            </ul>
        </section>
    </main>

    <footer>
        <p>&copy; 2023 Moon Exploration</p>
    </footer>

    <script src="//unpkg.com/d3-array"></script>
    <script src="//unpkg.com/d3-scale"></script>
    <script src="//unpkg.com/globe.gl"></script>
    <script src="//unpkg.com/three"></script>
    <script src="buttons.js"></script>

<script>
   

    function updateGlobeSize() {
        // Function to update the globe size and projection on resize
        const elem = document.getElementById('moonContainer');
        moon
            .width(elem.clientWidth)
            .height(elem.clientHeight);
    }


    function loadMoonquakesData() {
        fetch('./moonquakes.json')
            .then((response) => response.json())
            .then((data) => {
                moonquakesData = data;
                console.log("Moonquakes sites loaded");
            })
            .catch((error) => {
                console.error('Error loading moonquakes  data:', error);
            });
    }

    function loadLandingSitesData() {
        fetch('./moon_landings.json')
            .then((response) => response.json())
            .then((data) => {
                landingSitesData = data;
                console.log("Landing sites loaded");
            })
            .catch((error) => {
                console.error('Error loading landing site data:', error);
            });
    }

        
    function dayCycle() {
        setTimeout(() => {
            // Wait for the scene to be populated (asynchronously)
            const directionalLight = moon.scene().children.find(obj3d => obj3d.type === 'DirectionalLight');
            directionalLight && directionalLight.position.set(1, 0, 0); // Change light position to see the specularMap's effect

            const ambientLight = moon.scene().children.find(obj3d => obj3d.type === 'AmbientLight');
            if (ambientLight) {
            moon.scene().remove(ambientLight);
            }
        }, 500);

        // Create an orbit path
        const orbitRadius = 5; // Adjust the radius of the orbit path as needed
        const orbitSegments = 64; // Adjust the number of segments for a smoother appearance
        const orbitGeometry = new THREE.CircleGeometry(orbitRadius, orbitSegments);
        const orbitMaterial = new THREE.LineBasicMaterial({ color: 0xffffff });
        const orbit = new THREE.Line(orbitGeometry, orbitMaterial);
        orbit.rotation.x = Math.PI / 2; // Rotate the orbit path to be horizontal
        moon.scene().add(orbit);

        // Define a function to make the directional light orbit
        function orbitDirectionalLight() {
            const directionalLight = moon.scene().children.find(obj3d => obj3d.type === 'DirectionalLight');
            if (directionalLight) {
            // Adjust the orbit speed as needed
            const orbitSpeed = 0.00005;

            // Update the position of the directional light to follow the orbit path
            const currentTime = Date.now();
            const angle = (currentTime * orbitSpeed) % (Math.PI * 2); // Calculate the angle based on time
            const x = orbitRadius * Math.cos(angle);
            const z = orbitRadius * Math.sin(angle);
            directionalLight.position.set(x, 1, z);
            }

            // Request the next animation frame
            requestAnimationFrame(orbitDirectionalLight);
        }

        // Call the orbitDirectionalLight function to start the orbit animation
        orbitDirectionalLight();
    }

    function loadTexture(){
        const textureLoader = new THREE.TextureLoader();
        const texture = textureLoader.load('/resources/lunar_surface_4k.png'); // Adjust the path as needed
        // Listen for the resize event and update the globe size
        moon.globeMaterial(new THREE.MeshStandardMaterial({ map: texture }));      
    }

    const moonContainer = document.getElementById('moonContainer');
    const moon = Globe()
        //.globeImageUrl('/resources/lunar_surface_4k.png')
        .bumpImageUrl('/resources/lunar_height_map_16.png')
        .backgroundImageUrl('//unpkg.com/three-globe/example/img/night-sky.png')
        .showGraticules(false)
        .showAtmosphere(false) // moon has no atmosphere
        (moonContainer);



    //Load data to variables
    let landingSitesData = [];
    loadLandingSitesData();
    let moonquakesData = [];
    loadMoonquakesData();
    // Call the setupScene function to initialize your scene
    dayCycle();
    //Load Texture
    loadTexture();
    // Listen for the resize event and update the globe size

    window.addEventListener('resize', updateGlobeSize);
    // Call the updateGlobeSize function initially to set the initial size
    updateGlobeSize();
</script>
</body>
</html>
