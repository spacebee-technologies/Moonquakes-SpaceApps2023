<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moon Exploration</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
</head>
<body>
    <div class="navbar">
        <a href="#home">Home</a>
        <a href="#about">About</a>
        <a href="#landings">Recent Landings</a>
        <a href="#moonquakes">Moonquakes</a>
    </div>
    <div class="scene-nav-menu">
        <ul class="accordion menu-list" role="tablist">
            <div class="menu-title">Menu</div>
            <li class="accordion-item">
                <div class="toggle-container">
                    <p>Landing Site</p>
                    <label class="switch">
                    <input id="toggle_landingSites" type="checkbox">
                    <span class="slider"></span>
                    </label>
                </div>
            </li>
            <li class="accordion-item">
                <div class="toggle-container">
                    <p>Moonquakes</p>
                    <label class="switch">
                    <input id="toggle_moonquakes" type="checkbox" style="display: inline-block;">
                    <span class="slider"></span>
                    </label>
                </div>
            </li>
            <li class="accordion-item">
                <div class="toggle-container">
                    <p>Topographic </p>
                    <label class="switch">
                    <input id="toggle_topographic" type="checkbox">
                    <span class="slider"></span>
                    </label>
                </div>
            </li>
            <li class="accordion-item">
                <a id="accordion-label" class="accordion-title menu-name" role="tab" aria-expanded="false" aria-selected="false">Moon</a>
                <div class="accordion-content" data-tab-content="" role="tabpanel" aria-labelledby="33crh5-accordion-label" aria-hidden="false" id="33crh5-accordion" style="display: block;">
                    <table class="moon_table">
                        <tbody><tr><td>Diameter</td><td>3476.2 km</td></tr><tr><td>Semi-major Axis</td><td>384,400 km</td></tr><tr><td>Orbital Period</td><td>27.3 days</td></tr><tr><td>Mass</td><td>0.07342 kg</td></tr></tbody>
                    </table>
                </div>
            </li>
        </ul>
    </div>
    <div id="moonContainer">
    </div>

      
<!--
    <main>
        <section id="about">
            <h2>About Moon Exploration</h2>
            <p>Learn about historic moon landings and moonquakes on this interactive globe.</p>
        </section>

        <section id="landings">
            <h2>Recent Moon Landings</h2>
            <ul id="landingsList">
            </ul>
        </section>

        <section id="moonquakes">
            <h2>Moonquake Data</h2>
            <ul id="moonquakeList">
            </ul>
        </section>
    </main>

    <footer>
        <p>&copy; 2023 Moon Exploration</p>
    </footer>
    -->
    <script src="//unpkg.com/d3-array"></script>
    <script src="//unpkg.com/d3-scale"></script>
    <script src="//unpkg.com/globe.gl"></script>
    <script src="//unpkg.com/three"></script>
    <script src="js/buttons.js"></script>

<script>

    function updateGlobeSize() {
        // Function to update the globe size and projection on resize
        const elem = document.getElementById('moonContainer');
        moon
            .width(elem.clientWidth)
            .height(elem.clientHeight);
    }


    function loadMoonquakesData() {
        fetch('./moonquakes.json')
            .then((response) => response.json())
            .then((data) => {
                moonquakesData = data;
                console.log("Moonquakes sites loaded");
            })
            .catch((error) => {
                console.error('Error loading moonquakes  data:', error);
            });
    }

    function loadLandingSitesData() {
        fetch('./moon_landings.json')
            .then((response) => response.json())
            .then((data) => {
                landingSitesData = data;
                console.log("Landing sites loaded");
            })
            .catch((error) => {
                console.error('Error loading landing site data:', error);
            });
    }

    function ambientLightOn() {
        const directionalLight = moon.scene().children.find(obj3d => obj3d.type === 'DirectionalLight');
            if (directionalLight) {
                directionalLight.intensity=0;
            }
            const ambientLight = moon.scene().children.find(obj3d => obj3d.type === 'AmbientLight');
            if (ambientLight) {
                ambientLight.intensity=3.14;
            }
  }
  
  function ambientLightOFF() {
        const ambientLight = moon.scene().children.find(obj3d => obj3d.type === 'AmbientLight');
            if (ambientLight) {
                ambientLight.intensity=0;
            }
            const directionalLight = moon.scene().children.find(obj3d => obj3d.type === 'DirectionalLight');
            if (directionalLight) {
                directionalLight.intensity=2;
            }
  }
    function dayCycle(orbitSpeed) {
        setTimeout(() => {
            // Wait for the scene to be populated (asynchronously)
            ambientLightOFF();
        }, 500);

        // Create an orbit path
        const orbitRadius = 5; // Adjust the radius of the orbit path as needed
        const orbitSegments = 64; // Adjust the number of segments for a smoother appearance
        const orbitGeometry = new THREE.CircleGeometry(orbitRadius, orbitSegments);
        const orbitMaterial = new THREE.LineBasicMaterial({ color: 0xffffff });
        const orbit = new THREE.Line(orbitGeometry, orbitMaterial);
        orbit.rotation.x = Math.PI / 2; // Rotate the orbit path to be horizontal
        moon.scene().add(orbit);

        // Define a function to make the directional light orbit
        function orbitDirectionalLight() {
            const directionalLight = moon.scene().children.find(obj3d => obj3d.type === 'DirectionalLight');
            if (directionalLight) {
            // Adjust the orbit speed as needed
           
            // Update the position of the directional light to follow the orbit path
            const currentTime = Date.now();
            const angle = (currentTime * orbitSpeed) % (Math.PI * 2); // Calculate the angle based on time
            const x = orbitRadius * Math.cos(angle);
            const z = orbitRadius * Math.sin(angle);
            directionalLight.position.set(x, 1, z);
            }


            // Request the next animation frame
            requestAnimationFrame(orbitDirectionalLight);
        }

        // Call the orbitDirectionalLight function to start the orbit animation
        orbitDirectionalLight();
    }

    function loadTexture(){
        const textureLoader = new THREE.TextureLoader();
        const texture = textureLoader.load('/resources/lunar_surface_4k.png'); // Adjust the path as needed
        // Listen for the resize event and update the globe size
        moon.globeMaterial(new THREE.MeshStandardMaterial({ map: texture }));      
    }

    const moonContainer = document.getElementById('moonContainer');
    const moon = Globe()
        //.globeImageUrl('/resources/lunar_surface_4k.png')
        .bumpImageUrl('/resources/lunar_height_map_16.png')
        .backgroundImageUrl('//unpkg.com/three-globe/example/img/night-sky.png')
        .showGraticules(false)
        .showAtmosphere(false) // moon has no atmosphere
        (moonContainer);
        console.log(moon.scene());


    //Load data to variables
    let landingSitesData = [];
    loadLandingSitesData();
    let moonquakesData = [];
    loadMoonquakesData();
    // Call the setupScene function to initialize your scene
    const orbitSpeed = 0.0005;
    dayCycle(orbitSpeed);
    //Load Texture
    loadTexture();
    // Listen for the resize event and update the globe size



    window.addEventListener('resize', updateGlobeSize);
    // Call the updateGlobeSize function initially to set the initial size
    updateGlobeSize();
    
</script>
</body>
</html>
